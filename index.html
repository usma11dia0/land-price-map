<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>地図検索システム（実務修習）</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- アプリケーション CSS -->
    <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
    <div id="header">
        <div id="header-left">
            <h1>地図検索システム（実務修習）</h1>
        </div>
        <div id="search-area">
            <div id="external-links">
                <button id="btn-chikamap" class="external-link-btn" title="固定資産税路線価（全国地価マップ）">
                    <svg class="btn-icon-svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M4 15h16v2H4v-2zm0-8h16v2H4V7zm2 4h12v2H6v-2z"/>
                    </svg>
                    <span class="btn-text">路線価</span>
                </button>
                <button id="btn-google-maps" class="external-link-btn" title="Googleマップ">
                    <svg class="btn-icon-svg" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                    <span class="btn-text">Googleマップ</span>
                </button>
            </div>
            <div id="search-container">
                <input type="text" id="search-input" placeholder="住所を入力（例：東京都千代田区丸の内1丁目）">
                <button id="search-button">検索</button>
                <button id="settings-button" title="API使用状況">&#9432;</button>
            </div>
        </div>
    </div>
    <div id="search-results"></div>
    <div id="map"></div>

    <!-- 地価情報コントロールパネル -->
    <div id="land-price-control" class="land-price-control">
        <div class="land-price-control-header">
            <span>地価情報</span>
        </div>
        <div class="land-price-control-body">
            <label class="land-price-checkbox">
                <input type="checkbox" id="show-koji" />
                <span class="checkbox-icon koji-icon"></span>
                <span>地価公示</span>
            </label>
            <label class="land-price-checkbox">
                <input type="checkbox" id="show-chosa" />
                <span class="checkbox-icon chosa-icon"></span>
                <span>都道府県地価調査</span>
            </label>
            <button id="land-price-search-btn" class="land-price-search-btn" disabled>
                この範囲で検索
            </button>
            <div id="land-price-loading" class="land-price-loading" style="display: none;">
                <span class="spinner"></span>
                <span>読み込み中...</span>
            </div>
            <div id="land-price-count" class="land-price-count" style="display: none;">
                <span id="land-price-count-value">0</span>件表示中
            </div>
        </div>
    </div>

    <!-- ストリートビューモーダル -->
    <div id="streetview-modal" class="modal-overlay">
        <div class="modal modal-streetview">
            <div class="modal-header">
                <h2>📷 ストリートビュー</h2>
                <button class="modal-close" onclick="closeStreetViewModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="streetview-container">
                    <div id="streetview-loading" class="streetview-loading">
                        <span>読み込み中...</span>
                    </div>
                    <img id="streetview-image" class="streetview-image" alt="ストリートビュー画像" />
                    <div id="streetview-date" class="streetview-date"></div>
                    <div id="streetview-error" class="streetview-error" style="display: none;">
                        <p>😢 この地点のストリートビュー画像は利用できません</p>
                    </div>
                </div>
                <div class="streetview-controls">
                    <label>
                        方角:
                        <input type="range" id="streetview-heading" min="0" max="360" value="0" />
                        <span id="streetview-heading-value">0°</span>
                    </label>
                </div>
                <p class="streetview-note">※ ピンの位置周辺のGoogle Street View画像を表示しています</p>
            </div>
        </div>
    </div>

    <!-- 設定モーダル -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h2>設定</h2>
                <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="usage-section">
                    <h3>API使用状況（Google Geocoding API）</h3>
                    <div class="usage-stats">
                        <div class="usage-row">
                            <span class="usage-label">今月の使用回数</span>
                            <span id="usage-current" class="usage-value">0</span>
                        </div>
                        <div class="usage-row">
                            <span class="usage-label">月間上限</span>
                            <span id="usage-limit" class="usage-value">100</span>
                        </div>
                        <div class="usage-row">
                            <span class="usage-label">残り回数</span>
                            <span id="usage-remaining" class="usage-value">100</span>
                        </div>
                        <div class="usage-bar">
                            <div id="usage-bar-fill" class="usage-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="usage-row usage-total">
                            <span class="usage-label">累計使用回数</span>
                            <span id="usage-total" class="usage-value">0</span>
                        </div>
                    </div>
                    <p class="usage-note">※ 使用回数は毎月1日に自動リセットされます</p>
                    <div class="usage-limit-info">
                        <p><strong>上限到達時の動作：</strong></p>
                        <p>番地レベルの精度（Google Geocoding API）での検索ができなくなります。国土地理院の住所検索（町丁目レベル）は引き続き利用可能です。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 地価情報詳細モーダル -->
    <div id="land-price-modal" class="modal-overlay">
        <div class="modal modal-land-price">
            <div class="modal-header">
                <h2 id="land-price-modal-title">地価情報</h2>
                <button class="modal-close" onclick="closeLandPriceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- 基本情報 -->
                <div class="land-price-section">
                    <h3>基本情報</h3>
                    <table class="land-price-table">
                        <tr>
                            <th>標準地/基準地番号</th>
                            <td id="lp-standard-lot-number">-</td>
                        </tr>
                        <tr>
                            <th>所在及び地番</th>
                            <td id="lp-location-number">-</td>
                        </tr>
                        <tr>
                            <th>住居表示</th>
                            <td id="lp-residence-display">-</td>
                        </tr>
                    </table>
                </div>

                <!-- 価格情報 -->
                <div class="land-price-section">
                    <h3>価格情報</h3>
                    <div class="price-highlight">
                        <span class="price-label">当年価格</span>
                        <span id="lp-current-price" class="price-value">-</span>
                        <span class="price-unit">円/㎡</span>
                    </div>
                    <div class="change-rate">
                        <span class="change-label">対前年変動率</span>
                        <span id="lp-change-rate" class="change-value">-</span>
                    </div>

                    <!-- 過去5年の価格推移テーブル -->
                    <h4>過去5年の価格推移</h4>
                    <div id="lp-history-loading" class="history-loading" style="display: none;">
                        <span class="loading-spinner-small"></span> 読み込み中...
                    </div>
                    <table class="land-price-table history-table" id="lp-history-table">
                        <thead>
                            <tr>
                                <th>年度</th>
                                <th>価格(円/㎡)</th>
                                <th>変動率</th>
                            </tr>
                        </thead>
                        <tbody id="lp-price-history">
                        </tbody>
                    </table>
                </div>

                <!-- 土地情報 -->
                <div class="land-price-section">
                    <h3>土地情報</h3>
                    <table class="land-price-table">
                        <tr>
                            <th>用途区分</th>
                            <td id="lp-use-category">-</td>
                        </tr>
                        <tr>
                            <th>地積</th>
                            <td id="lp-cadastral">-</td>
                        </tr>
                        <tr>
                            <th>利用現況</th>
                            <td id="lp-usage-status">-</td>
                        </tr>
                        <tr>
                            <th>周辺の土地利用</th>
                            <td id="lp-surrounding-usage">-</td>
                        </tr>
                    </table>
                </div>

                <!-- 道路情報 -->
                <div class="land-price-section">
                    <h3>道路情報</h3>
                    <table class="land-price-table">
                        <tr>
                            <th>前面道路幅員</th>
                            <td id="lp-front-road-width">-</td>
                        </tr>
                        <tr>
                            <th>前面道路の方位</th>
                            <td id="lp-front-road-azimuth">-</td>
                        </tr>
                        <tr>
                            <th>前面道路の舗装</th>
                            <td id="lp-front-road-pavement">-</td>
                        </tr>
                        <tr>
                            <th>側道</th>
                            <td id="lp-side-road">-</td>
                        </tr>
                    </table>
                </div>

                <!-- 交通情報 -->
                <div class="land-price-section">
                    <h3>交通情報</h3>
                    <table class="land-price-table">
                        <tr>
                            <th>最寄り駅</th>
                            <td id="lp-nearest-station">-</td>
                        </tr>
                        <tr>
                            <th>駅までの距離</th>
                            <td id="lp-distance-to-station">-</td>
                        </tr>
                        <tr>
                            <th>交通施設近接</th>
                            <td id="lp-proximity-transportation">-</td>
                        </tr>
                    </table>
                </div>

                <!-- 法規制情報 -->
                <div class="land-price-section">
                    <h3>法規制情報</h3>
                    <table class="land-price-table">
                        <tr>
                            <th>用途地域</th>
                            <td id="lp-regulations-use-category">-</td>
                        </tr>
                        <tr>
                            <th>建蔽率</th>
                            <td id="lp-building-coverage">-</td>
                        </tr>
                        <tr>
                            <th>容積率</th>
                            <td id="lp-floor-area-ratio">-</td>
                        </tr>
                        <tr>
                            <th>防火地域</th>
                            <td id="lp-fireproof">-</td>
                        </tr>
                        <tr>
                            <th>高度地区</th>
                            <td id="lp-altitude-district">-</td>
                        </tr>
                    </table>
                    <p class="ratio-note" id="lp-ratio-note" style="display: none;">
                        ★ 指定容積率を上回る容積率を使用することを前提に価格を決定した地点
                    </p>
                </div>

                <!-- 鑑定評価書 -->
                <div class="land-price-section" id="lp-appraisal-section" style="display: none;">
                    <h3>鑑定評価書</h3>
                    <a id="lp-appraisal-link" href="#" target="_blank" class="appraisal-link">
                        <svg class="appraisal-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                        詳細表示（不動産情報ライブラリ）
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- アプリケーション JavaScript -->
    <script type="module" src="dist/app.js"></script>
</body>
</html>
